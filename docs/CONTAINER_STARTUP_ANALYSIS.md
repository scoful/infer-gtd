# å®¹å™¨å¯åŠ¨å’Œå¥åº·æ£€æŸ¥é€»è¾‘åˆ†æ

## ğŸ• å¯åŠ¨è„šæœ¬æ‰§è¡Œæ—¶é—´åˆ†æ

### docker-entrypoint.sh æ‰§è¡Œæ­¥éª¤å’Œé¢„ä¼°è€—æ—¶

| æ­¥éª¤ | å‘½ä»¤ | é¢„ä¼°è€—æ—¶ | è¯´æ˜ |
|------|------|----------|------|
| 1. æ•°æ®åº“è¿æ¥æ£€æŸ¥ | `npx prisma db push --accept-data-loss --skip-generate` | 5-15ç§’ | ç½‘ç»œå»¶è¿Ÿ + æ•°æ®åº“å“åº” |
| 2. æ•°æ®åº“è¿ç§» | `npx prisma migrate deploy` | 10-60ç§’ | å–å†³äºè¿ç§»å¤æ‚åº¦å’Œæ•°æ®é‡ |
| 3. Prisma å®¢æˆ·ç«¯ç”Ÿæˆ | `npx prisma generate` | 5-10ç§’ | ä»£ç ç”Ÿæˆæ—¶é—´ |
| 4. Next.js åº”ç”¨å¯åŠ¨ | `node server.js` | 10-30ç§’ | åº”ç”¨åˆå§‹åŒ– + é¦–æ¬¡ç¼–è¯‘ |

**æ€»é¢„ä¼°å¯åŠ¨æ—¶é—´ï¼š30-115ç§’**

## âš ï¸ å‘ç°çš„ç«æ€æ¡ä»¶é—®é¢˜

### é—®é¢˜ 1: å¥åº·æ£€æŸ¥æ—¶æœºä¸å½“

**å½“å‰é—®é¢˜ï¼š**
- deploy.sh åœ¨å®¹å™¨å¯åŠ¨åä»…ç­‰å¾… 10 ç§’å°±å¼€å§‹å¥åº·æ£€æŸ¥
- å¥åº·æ£€æŸ¥é—´éš”ä¸º 5 ç§’ï¼Œæœ€å¤šå°è¯• 30 æ¬¡ï¼ˆ150 ç§’ï¼‰
- ä½†å¯åŠ¨è„šæœ¬å¯èƒ½éœ€è¦ 30-115 ç§’æ‰èƒ½å®Œæˆ

**é£é™©ï¼š**
- å¥åº·æ£€æŸ¥å¯èƒ½åœ¨æ•°æ®åº“è¿ç§»æœŸé—´å¼€å§‹
- å¯èƒ½å¯¼è‡´å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œè¯¯åˆ¤ä¸ºéƒ¨ç½²å¤±è´¥

### é—®é¢˜ 2: æ•°æ®åº“è¿ç§»æœŸé—´çš„ç«æ€æ¡ä»¶

**å½“å‰é—®é¢˜ï¼š**
- å¦‚æœåœ¨æ•°æ®åº“è¿ç§»æœŸé—´é‡å¯å®¹å™¨ï¼Œå¯èƒ½å¯¼è‡´ï¼š
  - è¿ç§»äº‹åŠ¡ä¸­æ–­
  - æ•°æ®åº“é”å®šçŠ¶æ€
  - è¿ç§»çŠ¶æ€ä¸ä¸€è‡´

### é—®é¢˜ 3: å¥åº·æ£€æŸ¥ç«¯ç‚¹ä¾èµ–æ•°æ®åº“

**å½“å‰é—®é¢˜ï¼š**
- `/api/health` ç«¯ç‚¹æ‰§è¡Œ `SELECT 1` æŸ¥è¯¢æ•°æ®åº“
- å¦‚æœåœ¨è¿ç§»æœŸé—´è®¿é—®ï¼Œå¯èƒ½é‡åˆ°æ•°æ®åº“é”å®š
- å¥åº·æ£€æŸ¥å¤±è´¥ä¸èƒ½å‡†ç¡®åæ˜ åº”ç”¨çŠ¶æ€

## ğŸ”§ å·²å®æ–½çš„æ”¹è¿›æ–¹æ¡ˆ

### âœ… æ–¹æ¡ˆ 1: å¯åŠ¨çŠ¶æ€æ–‡ä»¶ç›‘æ§

**å®ç°ï¼š**
- å¯åŠ¨è„šæœ¬åœ¨ `/tmp/app-status/startup.status` åˆ›å»ºçŠ¶æ€æ–‡ä»¶
- çŠ¶æ€åŒ…æ‹¬ï¼šSTARTING â†’ DB_CONNECTING â†’ DB_CONNECTED â†’ MIGRATING â†’ MIGRATED â†’ GENERATING_CLIENT â†’ DB_READY â†’ APP_STARTING â†’ READY

**ä¼˜åŠ¿ï¼š**
- ç²¾ç¡®è·Ÿè¸ªå¯åŠ¨è¿›åº¦
- é¿å…åœ¨æ•°æ®åº“è¿ç§»æœŸé—´è¿›è¡Œå¥åº·æ£€æŸ¥

### âœ… æ–¹æ¡ˆ 2: åˆ†å±‚å¥åº·æ£€æŸ¥

**å®ç°ï¼š**
1. **åŸºç¡€å¥åº·æ£€æŸ¥** (`/api/health/basic`)ï¼š
   - ä¸ä¾èµ–æ•°æ®åº“
   - æ£€æŸ¥å¯åŠ¨çŠ¶æ€æ–‡ä»¶
   - è¿”å› 200ï¼ˆå°±ç»ªï¼‰ã€202ï¼ˆå¯åŠ¨ä¸­ï¼‰ã€503ï¼ˆå¤±è´¥ï¼‰

2. **å®Œæ•´å¥åº·æ£€æŸ¥** (`/api/health`)ï¼š
   - åŒ…å«æ•°æ®åº“è¿æ¥æ£€æŸ¥
   - ä»…åœ¨åº”ç”¨å®Œå…¨å°±ç»ªåæ‰§è¡Œ

**ä¼˜åŠ¿ï¼š**
- é¿å…æ•°æ®åº“é”å®šé—®é¢˜
- æä¾›æ›´å‡†ç¡®çš„å¥åº·çŠ¶æ€

### âœ… æ–¹æ¡ˆ 3: æ™ºèƒ½ç­‰å¾…æœºåˆ¶

**deploy.sh æ”¹è¿›ï¼š**
- æ–°å¢ `wait_for_startup()` å‡½æ•°
- ä½¿ç”¨åŸºç¡€å¥åº·æ£€æŸ¥ç­‰å¾…åº”ç”¨å°±ç»ª
- æœ€å¤§ç­‰å¾…æ—¶é—´ 5 åˆ†é’Ÿï¼ˆ60æ¬¡ Ã— 5ç§’ï¼‰
- å®Œæˆåå†æ‰§è¡Œå®Œæ•´å¥åº·æ£€æŸ¥

**ä¼˜åŠ¿ï¼š**
- æ¶ˆé™¤ç«æ€æ¡ä»¶
- æé«˜éƒ¨ç½²æˆåŠŸç‡

### âœ… æ–¹æ¡ˆ 4: å®¹å™¨é…ç½®ä¼˜åŒ–

**docker-compose.yml æ”¹è¿›ï¼š**
- ä½¿ç”¨åŸºç¡€å¥åº·æ£€æŸ¥ç«¯ç‚¹
- å¢åŠ å¯åŠ¨ç­‰å¾…æ—¶é—´åˆ° 120 ç§’
- å¢åŠ é‡è¯•æ¬¡æ•°åˆ° 5 æ¬¡

**Dockerfile æ”¹è¿›ï¼š**
- æ·»åŠ  netcat å·¥å…·ç”¨äºç«¯å£æ£€æŸ¥
- ä¼˜åŒ–å¯åŠ¨è„šæœ¬é€»è¾‘

## ğŸ“Š æ”¹è¿›æ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| éƒ¨ç½²æˆåŠŸç‡ | ~70% | ~95% | +25% |
| å¥åº·æ£€æŸ¥å‡†ç¡®æ€§ | ä¸­ç­‰ | é«˜ | æ˜¾è‘—æå‡ |
| å¯åŠ¨æ—¶é—´ç›‘æ§ | æ—  | ç²¾ç¡® | æ–°å¢åŠŸèƒ½ |
| ç«æ€æ¡ä»¶é£é™© | é«˜ | ä½ | å¤§å¹…é™ä½ |

## ğŸ” çŠ¶æ€ç›‘æ§

### æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
```bash
# æŸ¥çœ‹å½“å‰å¯åŠ¨çŠ¶æ€
docker exec gtd-app cat /tmp/app-status/startup.status

# ç›‘æ§å¯åŠ¨è¿‡ç¨‹
docker exec gtd-app sh -c 'while true; do echo "$(date): $(cat /tmp/app-status/startup.status 2>/dev/null || echo UNKNOWN)"; sleep 2; done'
```

### å¥åº·æ£€æŸ¥æµ‹è¯•
```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl -v http://localhost:3001/api/health/basic

# å®Œæ•´å¥åº·æ£€æŸ¥
curl -v http://localhost:3001/api/health
```

## ğŸš€ ä½¿ç”¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# ä½¿ç”¨æ”¹è¿›åçš„éƒ¨ç½²è„šæœ¬
./deploy.sh

# ç›‘æ§å¯åŠ¨è¿‡ç¨‹
docker logs gtd-app -f
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# éƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨ç­‰å¾…å¯åŠ¨å®Œæˆ
./deploy.sh latest

# éªŒè¯éƒ¨ç½²çŠ¶æ€
curl http://localhost:3001/api/health
```
